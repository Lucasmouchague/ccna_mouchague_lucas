# TP1
## I 
### Récupérer la liste des cartes réseau.
```
[nawak@cor91-h02-176-136-150-129 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:64:ac:53 brd ff:ff:ff:ff:ff:ff
    inet 176.136.150.129/24 brd 176.136.150.255 scope global dynamic noprefixroute ens33
       valid_lft 1570sec preferred_lft 1570sec
    inet6 fe80::6020:7913:386e:db0b/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: ens36: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:64:ac:5d brd ff:ff:ff:ff:ff:ff
    inet 10.0.0.10/24 brd 10.0.0.255 scope global noprefixroute ens36
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe64:ac5d/64 scope link 
       valid_lft forever preferred_lft forever
4: ens37: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc fq_codel master bond0 state UP group default qlen 1000
    link/ether 00:0c:29:64:ac:67 brd ff:ff:ff:ff:ff:ff
5: ens38: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc fq_codel master bond0 state UP group default qlen 1000
    link/ether 00:0c:29:64:ac:67 brd ff:ff:ff:ff:ff:ff
6: bond0: <BROADCAST,MULTICAST,MASTER,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:0c:29:64:ac:67 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.100/24 brd 10.1.1.255 scope global noprefixroute bond0
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe64:ac67/64 scope link 
       valid_lft forever preferred_lft forever
[nawak@cor91-h02-176-136-150-129 ~]$ 
```
### Déterminer si elles sont elles ont une IP statique ou DHCP
```
*waiting*
``` 
### Afficher la table de routage
```
*waiting*
```
### Récuperer la liste des ports en écoute.
```
[nawak@cor91-h02-176-136-150-129 ~]$ ss -tul
Netid                   State                      Recv-Q                     Send-Q                                                  Local Address:Port                                                  Peer Address:Port                    
udp                     UNCONN                     0                          0                                               176.136.150.129%ens33:bootpc                                                     0.0.0.0:*                       
udp                     UNCONN                     0                          0                                                           127.0.0.1:323                                                        0.0.0.0:*                       
udp                     UNCONN                     0                          0                                                               [::1]:323                                                           [::]:*                       
tcp                     LISTEN                     0                          128                                                           0.0.0.0:EtherNet/IP-1                                              0.0.0.0:*                       
tcp                     LISTEN                     0                          128                                                              [::]:EtherNet/IP-1                                                 [::]:*  
```
### Récupérer la liste des DNS utilisé par la machine.
```
[nawak@cor91-h02-176-136-150-129 ~]$ cat /etc/resolv.conf 
# Generated by NetworkManager
search localdomain dsl.sta.abo.bbox.fr
nameserver 176.136.150.2
```
```
[nawak@cor91-h02-176-136-150-129 ~]$ dig www.reddit.com

; <<>> DiG 9.11.4-P2-RedHat-9.11.4-17.P2.el8_0.1 <<>> www.reddit.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 46264
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; MBZ: 0x0005, udp: 65494
;; QUESTION SECTION:
;www.reddit.com.      IN  A

;; ANSWER SECTION:
www.reddit.com.   5 IN  CNAME reddit.map.fastly.net.
reddit.map.fastly.net.  5 IN  A 151.101.121.140

;; Query time: 18 msec
;; SERVER: 176.136.150.2#53(176.136.150.2) 
;; WHEN: Sat Sep 28 17:15:05 EDT 2019
;; MSG SIZE  rcvd: 94

```
On vois que la machine questionne le DNS ayant comme IP 176.136.150.2, qui est aussi présent dans le fichier resolv.conf.

### Afficher l'état actuel du firewall
```
[nawak@cor91-h02-176-136-150-129 ~]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: bond0 ens33 ens36 ens37 ens38
  sources: 
  services: cockpit dhcpv6-client ssh
  ports: 2222/tcp
  protocols: 
  masquerade: no
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules: 
```
On vois que les interfaces bond0, ens33, ens36, ens37, ens38 sont filtré. Les ports 2222, 9090, 22, 546 sont autorisé tout les autres sont filtré.
## II Edit configuration
### 1. Configuration cartes réseau
```
NAME=ens36
DEVICE=ens36
BOOTPROTO=static
ONBOOT=yes
IPADDR=10.0.0.10
NETMASK=255.255.255.0
```
Configuration de la première carte réseau
```
NAME=ens37
DEVICE=ens37
BOOTPROTO=static
ONBOOT=yes
IPADDR=10.1.1.10
NETMASK=255.255.255.0
```
Configuration de la seconde carte réseau
```
[nawak@cor91-h02-176-136-150-129 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:64:ac:53 brd ff:ff:ff:ff:ff:ff
    inet 176.136.150.129/24 brd 176.136.150.255 scope global dynamic noprefixroute ens33
       valid_lft 1635sec preferred_lft 1635sec
    inet6 fe80::6020:7913:386e:db0b/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: ens36: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:64:ac:5d brd ff:ff:ff:ff:ff:ff
    inet 10.0.0.10/24 brd 10.0.0.255 scope global noprefixroute ens36
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe64:ac5d/64 scope link 
       valid_lft forever preferred_lft forever
4: ens37: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:64:ac:67 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.10/24 brd 10.1.1.255 scope global noprefixroute ens37
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fe64:ac67/64 scope link 
       valid_lft forever preferred_lft forever
```
```
[nawak@cor91-h02-176-136-150-129 ~]$ ip neigh show
176.136.150.2 dev ens33 lladdr 00:50:56:f5:29:32 REACHABLE
10.0.0.1 dev ens36 lladdr 00:50:56:c0:00:01 REACHABLE
```

#### Team bonding
Configuration de la carte réseau ens37 : 
```
[nawak@cor91-h02-176-136-150-129 network-scripts]$ cat ifcfg-ens37
NAME=ens37
DEVICE=ens37
BOOTPROTO=static
ONBOOT=yes
MASTER=bond0
SLAVE=yes
```
Configuration de la carte réseau ens38 :
```
[nawak@cor91-h02-176-136-150-129 network-scripts]$ cat ifcfg-ens38
NAME=ens38
DEVICE=ens38
BOOTPROTO=static
ONBOOT=yes
MASTER=bond0
SLAVE=yes
```
Configuration de la carte réseau bond0 :
```
[nawak@cor91-h02-176-136-150-129 network-scripts]$ cat ifcfg-bond0 
DEVICE=bond0
BONDING_OPTS="miimon=1 updelay=0 downdelay=0 mode=active-backup" TYPE=Bond
BONDING_MASTER=yes
BOOTPROTO=none
IPADDR=10.1.1.100
PREFIX=24
NAME=bond0
ONBOOT=yes
```
Configuration du NIC :
```
[nawak@cor91-h02-176-136-150-129 network-scripts]$ cat /proc/net/bonding/bond0
Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)

Bonding Mode: load balancing (round-robin)
MII Status: up
MII Polling Interval (ms): 100
Up Delay (ms): 0
Down Delay (ms): 0

Slave Interface: ens37
MII Status: up
Speed: 1000 Mbps
Duplex: full
Link Failure Count: 0
Permanent HW addr: 00:0c:29:64:ac:67
Slave queue ID: 0

Slave Interface: ens38
MII Status: up
Speed: 1000 Mbps
Duplex: full
Link Failure Count: 0
Permanent HW addr: 00:0c:29:64:ac:71
Slave queue ID: 0
```

Preuve du fonctionnement :
```
nawak@T460:/media/nawak/ynov/reseau$ ping -c 4 10.1.1.100
PING 10.1.1.100 (10.1.1.100) 56(84) bytes of data.
64 bytes from 10.1.1.100: icmp_seq=1 ttl=64 time=0.529 ms
64 bytes from 10.1.1.100: icmp_seq=2 ttl=64 time=0.467 ms
64 bytes from 10.1.1.100: icmp_seq=3 ttl=64 time=0.485 ms
64 bytes from 10.1.1.100: icmp_seq=4 ttl=64 time=0.491 ms

--- 10.1.1.100 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3077ms
rtt min/avg/max/mdev = 0.467/0.493/0.529/0.022 ms
```
### 2. Serveur SSH :
#### Modification de la configuration SSH.
```
[nawak@cor91-h02-176-136-150-129 ~]$ sudo cat /etc/ssh/sshd_config 
[sudo] password for nawak: 
Sorry, try again.
[sudo] password for nawak: 
# $OpenBSD: sshd_config,v 1.103 2018/04/09 20:41:22 tj Exp $

# This is the sshd server system-wide configuration file.  See
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options override the
# default value.

# If you want to change the port on a SELinux system, you have to tell
# SELinux about this change.
# semanage port -a -t ssh_port_t -p tcp #PORTNUMBER
#
Port 2222
#AddressFamily any
#ListenAddress 0.0.0.0
#ListenAddress ::

```
On vois ici le fichier de config de sshd. J'ai décommenter la ligne "Port" et j'ai renseigner le port 2222.
```
[nawak@cor91-h02-176-136-150-129 ~]$ sudo firewall-cmd --list-all
[sudo] password for nawak: 
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: bond0 ens33 ens36 ens37 ens38
  sources: 
  services: cockpit dhcpv6-client ssh
  ports: 2222/tcp
  protocols: 
  masquerade: no
  forward-ports: 
  source-ports: 
  icmp-blocks: 
  rich rules: 
```
J'ai donc autorisé le port 2222 a communiquer a travers le firewall.
#### Analyse des trames de connexion au serveur SSH.
## III Routage simple.
### Tableau récapitulatif des IPs
| Machine | NAT             | net1       | net2       |
|---------|-----------------|------------|------------|
| Router  | 192.168.176.169 | 10.0.0.254 | 10.1.1.254 |
| VM1     |        X        |  10.0.0.10 |      X     |
| VM2     |        X        |      X     |  10.1.1.10 |
### Configuration de VM1
```
TYPE="Ethernet"
BOOTPROTO="static"
NAME="ens33"
UUID="8e0ac214-14aa-47f6-85f4-1ae17d70349d"
DEVICE="ens33"
ONBOOT="yes"
IPADDR=10.0.0.10
NETMASK=255.255.255.0
GATEWAY=10.0.0.254
DNS1=10.0.0.254
DNS2=8.8.8.8
```
### Configuration de VM2
```
TYPE="Ethernet"
BOOTPROTO="static"
NAME="ens33"
UUID="8e0ac214-14aa-47f6-85f4-1ae17d70349d"
DEVICE="ens33"
ONBOOT="yes"
IPADDR=10.1.1.10
NETMASK=255.255.255.0
GATEWAY=10.1.1.254
DNS1=10.1.1.254
DNS2=8.8.8.8
```
### Configuration de Router
#### Carte réseau net1
```
IPADDR=10.0.0.254
NETMASK=255.255.255.0
ONBOOT=yes
DEVICE=ens37
NAME=ens37
TYPE=Ethernet
BOOTPROTO=static
PROXY_METHOD=none
BROWSER_ONLY=no
PREFIX=24
DNS1=8.8.8.8
DNS2=1.1.1.1
DNS3=1.0.0.1
DEFROUTE=no
IPV4_FAILURE_FATAL=yes
IPV6INIT=no
UUID=4a5516a4-dfa4-24af-b1c4-e843e312e2fd
```
#### Carte réseau net2
```
IPADDR=10.1.1.254
NETMASK=255.255.255.0
ONBOOT=yes
DEVICE=ens38
NAME=ens38
TYPE=Ethernet
BOOTPROTO=static
PROXY_METHOD=none
BROWSER_ONLY=no
PREFIX=24
DNS1=8.8.8.8
DNS2=1.1.1.1
DNS3=1.0.0.1
```
#### Carte réseau NAT
Elle est configuré en DHCP et donc prend automatiquement un IP donné par mon virtualiseur préféré.
### Preuve que VM1 passe par le router.
```
[nawak@VM1 ~]$ traceroute www.google.com
traceroute to www.google.com (172.217.19.228), 30 hops max, 60 byte packets
 1  _gateway (10.0.0.254)  1.281 ms  1.228 ms  1.190 ms
 2  192.168.176.2 (192.168.176.2)  1.060 ms  1.019 ms  0.981 ms
```
Sur la requête traceroute vers www.google.com on vois que le premier saut se dirige vers le router (10.0.0.254) et après se dirige vers la gateway du réseau NAT du router pour acceder a internet.
## IV
### 1. Commandes
```
[nawak@VM1 ~]$ iftop
-bash: iftop: command not found
```
C'est comme offrir un jouer sans pile a un enfant a noel.
Sinon plus serieusement iftop permet de surveiller le trafic entrant et sortant sur une interface donner. On pourrait s'en servir pour verifier si des connexions son effectuer sur notre machine et ça peut être un problème si ce sont des connexions inattendu.

### 2. Cockpit
Cockpit est un outil d'administration système accéssible via un service web. Il permet de gerer les disques de monitorer le CPU, la RAM, la bande passante etc... Il dispose même d'un terminal INCROYABLE. Et on peux aussi ajouter plusieurs serveur disposant de cockpit et les gerers d'une seule interface web.

Pour savoir quel port écouté Cockpit on exécute la commande suivante:
```
[nawak@VM1 ~]$ ss | grep cockpit
[nawak@VM1 ~]$ ss | grep 9090
```
Ha bah nan il veut pas heuresement que je l'utilise deja personellement.
J'ai bien sur ouvert le port 9090 sur mon firewall
```
[nawak@VM1 ~]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: ens33
  sources:
  services: cockpit dhcpv6-client ssh
  ports: 22/tcp 9090/tcp
  protocols:
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
```
🌞 Exploration de Cockpit.
### 3. Netdata
il faut cloner le repository netdata
```
git clone https://github.com/firehol/netdata.git --depth=1
```
Puis dans le dossier netdata il y a un executable qui installe tout seul netdata.
On autorise aussi le port 19999 a travers le firewall
```
[nawak@VM1 netdata]$ sudo firewall-cmd --add-port=19999/tcp --permanent 
[nawak@VM1 netdata]$ sudo firewall-cmd --reload
```
